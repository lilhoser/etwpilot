<UserControl x:Class="EtwPilot.View.ProviderFilterFormView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:EtwPilot.View"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800"
             DataContext="{StaticResource g_MainWindowViewModel}">
    <Grid>
        <TabControl>
            <TabItem Header="Scope">
                <StackPanel Orientation="Vertical" Margin="5">
                    <StackPanel Orientation="Horizontal" Margin="5" VerticalAlignment="Top">
                        <Label Width="150">Process ID:</Label>
                        <ListBox ItemsSource="{Binding m_SessionFormViewModel.ActiveProcessList}"
                                  Name="ScopeFilterProcesses"
                                  SelectedIndex="0"
                                  SelectionMode="Multiple"
                                  SelectionChanged="ScopeFilterProcess_SelectionChanged"
                                  MaxHeight="125">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock>
                                        <TextBlock.Text>
                                            <MultiBinding StringFormat="{}{0}({1})">
                                                <Binding Path="Name"/>
                                                <Binding Path="Pid"/>
                                            </MultiBinding>
                                        </TextBlock.Text>
                                    </TextBlock>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="5" VerticalAlignment="Top">
                        <Label Width="150">EXE Name:</Label>
                        <ListBox ItemsSource="{Binding m_SessionFormViewModel.UniqueExeNames}"
                                  Name="ScopeFilterExes"
                                  SelectedIndex="0"
                                  SelectionMode="Multiple"
                                  SelectionChanged="ScopeFilterExes_SelectionChanged"
                                  MaxHeight="125"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="5" VerticalAlignment="Top">
                        <Label Width="150">App ID:</Label>
                        <ListBox ItemsSource="{Binding m_SessionFormViewModel.UniqueAppIds}"
                                  Name="ScopeFilterAppIds"
                                  SelectedIndex="0"
                                  SelectionMode="Multiple"
                                  SelectionChanged="ScopeFilterAppIds_SelectionChanged"
                                  MaxHeight="125" />
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="5" VerticalAlignment="Top">
                        <Label Width="150">Package ID:</Label>
                        <ListBox ItemsSource="{Binding m_SessionFormViewModel.UniquePackageIds}"
                                  Name="ScopeFilterPackageIds"
                                  SelectedIndex="0"
                                  SelectionMode="Multiple"
                                  SelectionChanged="ScopeFilterPackageIds_SelectionChanged"
                                  MaxHeight="125"/>
                    </StackPanel>
                </StackPanel>
            </TabItem>
            <TabItem Header="Attribute" 
                     Name="AttributeTab"
                     DataContext="{Binding m_SessionFormViewModel.CurrentProviderFilterForm,Mode=TwoWay}">
                <StackPanel Orientation="Vertical" Margin="5">
                    <StackPanel Orientation="Horizontal" Margin="5">
                        <Label Width="150">Events:</Label>
                        <ListBox ItemsSource="{Binding Manifest.Events}"
                                 Name="AttributeFilterEvents"
                                 SelectionMode="Multiple"
                                 Width="Auto"
                                 MaxWidth="600"
                                 MaxHeight="250"
                                 SelectionChanged="AttributeFilterEvents_SelectionChanged"
                                 SelectedItem="{Binding Events,ValidatesOnNotifyDataErrors=True,UpdateSourceTrigger=PropertyChanged}"
                                 Validation.ValidationAdornerSite="{Binding ElementName=EventsErrorAdornerSite}"/>
                        <StackPanel Width="125" Orientation="Horizontal">
                            <RadioButton GroupName="EnableDisableGroup"
                                         Name="EnableButton"
                                         Content="Enable"
                                         Validation.ErrorTemplate="{x:Null}"
                                         IsChecked="{Binding AttributeFilter.IsEnable,ValidatesOnNotifyDataErrors=True,Converter={StaticResource NullableBoolConverter},ConverterParameter='true'}"
                                         Validation.ValidationAdornerSite="{Binding ElementName=EventsErrorAdornerSite}"/>
                            <Separator Opacity="0" Width="10"/>
                            <RadioButton GroupName="EnableDisableGroup" 
                                         Name="DisableButton"
                                         Content="Disable"
                                         Validation.ErrorTemplate="{x:Null}"
                                         IsChecked="{Binding AttributeFilter.IsEnable,ValidatesOnNotifyDataErrors=True,Converter={StaticResource NullableBoolConverter},ConverterParameter='false'}"
                                         Validation.ValidationAdornerSite="{Binding ElementName=EventsErrorAdornerSite}"/>
                        </StackPanel>
                        <Separator Opacity="0" Width="5"/>
                        <Label Name="EventsErrorAdornerSite"
                               Width="125"
                               VerticalAlignment="Top"
                               Margin="0" Padding="0"
                               Validation.ErrorTemplate="{DynamicResource ValidationErrorTemplate}"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="5">
                        <Label Width="150">Level:</Label>
                        <ComboBox Width="150" Name="AttributeFilterLevel"
                                  ItemsSource="{Binding Source={StaticResource SourceLevelsEnum}}"
                                  SelectedIndex="0"
                                  SelectedItem="{Binding AttributeFilter.Level}"
                                  IsSynchronizedWithCurrentItem="false"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="5">
                        <Label Width="150">Any keywords:</Label>
                        <ListBox ItemsSource="{Binding Manifest.Keywords}" Name="AttributeFilterAnyKeywords"
                                 SelectionChanged="AttributeFilterAnyKeywords_SelectionChanged"
                                 SelectionMode="Multiple"
                                 MaxWidth="600"
                                 MaxHeight="250"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="5">
                        <Label Width="150">All keywords:</Label>
                        <ListBox ItemsSource="{Binding Manifest.Keywords}" Name="AttributeFilterAllKeywords"
                                 SelectionMode="Multiple"
                                 SelectionChanged="AttributeFilterAllKeywords_SelectionChanged"
                                 MaxWidth="600"
                                 MaxHeight="250"/>
                    </StackPanel>
                </StackPanel>
            </TabItem>
            <TabItem Header="Stackwalk"
                     DataContext="{Binding m_SessionFormViewModel.CurrentProviderFilterForm,Mode=TwoWay}">
                <StackPanel Orientation="Vertical" Margin="5">
                    <StackPanel Orientation="Horizontal" Margin="5">
                        <Label Width="150">Events:</Label>
                        <ListBox ItemsSource="{Binding Manifest.Events}" Name="StackwalkFilterEvents"
                                 SelectionMode="Multiple"
                                 SelectionChanged="StackwalkFilterEvents_SelectionChanged"
                                 MaxWidth="600"
                                 MaxHeight="250"/>
                        <StackPanel Width="125" Orientation="Horizontal">
                            <RadioButton GroupName="EnableDisableGroup" 
                                         Content="Enable"
                                         IsChecked="{Binding StackwalkFilter.IsEnable,Mode=OneWayToSource}"/>
                            <Separator Opacity="0" Width="10"/>
                            <RadioButton GroupName="EnableDisableGroup" Content="Disable"/>
                        </StackPanel>
                    </StackPanel>
                    <StackPanel Orientation="Vertical">
                        <GroupBox Header="Level/Keyword Filter">
                            <StackPanel Orientation="Vertical">
                                <StackPanel Orientation="Horizontal" Margin="5">
                                    <Label Width="150">Level:</Label>
                                    <ComboBox Width="150" Name="StackwalkLevelKeywordFilterLevel"
                                              ItemsSource="{Binding Source={StaticResource SourceLevelsEnum}}"
                                              SelectedIndex="0"
                                              IsSynchronizedWithCurrentItem="false"
                                              SelectedItem="{Binding StackwalkFilter.LevelKeywordFilterLevel,Mode=OneWayToSource}"/>
                                    <Separator Opacity="0" Width="75"/>
                                    <StackPanel Width="125" Orientation="Horizontal">
                                        <RadioButton GroupName="EnableDisableGroup" 
                                                     Content="Enable"
                                                     IsChecked="{Binding StackwalkFilter.LevelKeywordFilterIsEnable,Mode=OneWayToSource}"/>
                                        <Separator Opacity="0" Width="10"/>
                                        <RadioButton GroupName="EnableDisableGroup" Content="Disable"/>
                                    </StackPanel>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="5">
                                    <Label Width="150">Any keywords:</Label>
                                    <ListBox ItemsSource="{Binding Manifest.Keywords}" Name="StackwalkLevelKeywordFilterAnyKeywords"
                                             SelectionMode="Multiple"
                                             MaxWidth="600"
                                             MaxHeight="250"
                                             SelectionChanged="StackwalkLevelKeywordFilterAnyKeywords_SelectionChanged"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="5">
                                    <Label Width="150">All keywords:</Label>
                                    <ListBox ItemsSource="{Binding Manifest.Keywords}" Name="StackwalkLevelKeywordFilterAllKeywords"
                                             SelectionMode="Multiple"
                                             MaxWidth="600"
                                             MaxHeight="250"
                                             SelectionChanged="StackwalkLevelKeywordFilterAllKeywords_SelectionChanged"/>
                                </StackPanel>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>
                </StackPanel>
            </TabItem>
            <TabItem Header="Payload"
                     DataContext="{Binding m_SessionFormViewModel.CurrentProviderFilterForm,Mode=TwoWay}">
                <StackPanel Orientation="Vertical" Margin="5">
                    <StackPanel Orientation="Horizontal">
                        <Label Width="100">Event:</Label>
                        <ListBox ItemsSource="{Binding EventsWithTemplates}" Name="PayloadFilterEvents"
                                 SelectedItem="{Binding SelectedPredicate.Event}"
                                 SelectionMode="Single"
                                 MaxWidth="500"
                                 MaxHeight="250"
                                 SelectionChanged="PayloadFilterEvents_SelectionChanged"
                                 IsEnabled="{Binding ElementName=AddPredicateButton,Path=IsEnabled}"/>
                        <Separator Width="5" Opacity="0"/>
                        <DataGrid Name="PayloadFilterPredicates"
                                  IsReadOnly="true"
                                  AutoGenerateColumns="false"
                                  ItemsSource="{Binding PayloadFilterPredicates}"
                                  SelectionMode="Extended"
                                  MouseDoubleClick="PayloadFilterPredicates_MouseDoubleClick"
                                  MinWidth="450"
                                  MaxHeight="220"
                                  VerticalAlignment="Top">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Event ID" Binding="{Binding Event.Id}"/>
                                <DataGridTextColumn Header="Version" Binding="{Binding Event.Version}" />
                                <DataGridTextColumn Header="Field" Binding="{Binding Field}" />
                                <DataGridTextColumn Header="Operator" Binding="{Binding Operator}" />
                                <DataGridTextColumn Header="Value" Binding="{Binding FieldValue}" />
                            </DataGrid.Columns>
                        </DataGrid>
                        <Separator Width="5" Opacity="0"/>
                        <Button Name="RemovePredicateButton"
                                Click="RemovePredicateButton_Click"
                                Height="25"
                                VerticalAlignment="Top">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SelectedItems.Count,ElementName=PayloadFilterPredicates}"
                                                        Value="0">
                                            <Setter Property="IsEnabled" Value="False" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                            Remove Predicate
                        </Button>
                    </StackPanel>
                    <Separator Opacity="0" Height="5"/>
                    <StackPanel Orientation="Horizontal">
                        <Label Width="100">Field name:</Label>
                        <ComboBox Name="PredicateFieldName" 
                                  Width="150" 
                                  IsSynchronizedWithCurrentItem="false"
                                  SelectedItem="{Binding SelectedPredicate.Field,UpdateSourceTrigger=Explicit}"/>
                        <Separator Opacity="0" Width="5"/>
                        <Button Name="AddPredicateButton" 
                                Click="AddPredicateButton_Click">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsUpdateMode}" Value="True">
                                            <Setter Property="IsEnabled" Value="False"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                            Add Predicate
                        </Button>
                        <Separator Opacity="0" Width="5"/>
                        <Button Name="UpdatePredicateButton"
                                Click="UpdatePredicateButton_Click"
                                IsEnabled="{Binding IsUpdateMode}">Update Predicate</Button>
                        <Separator Opacity="0" Width="5"/>
                        <Button Name="CancelUpdatePredicateButton"
                                Click="CancelUpdatePredicateButton_Click"
                                IsEnabled="False" Visibility="Hidden">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsUpdateMode}" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                            <Setter Property="IsEnabled" Value="True"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                            Cancel
                        </Button>
                    </StackPanel>
                    <Separator Opacity="0" Height="5"/>
                    <StackPanel Orientation="Horizontal">
                        <Label Width="100">Operator:</Label>
                        <ComboBox Width="150" Name="PredicateOperator"
                                  ItemsSource="{Binding Source={StaticResource PayloadFilterPredicateOperatorsEnum}}"
                                  IsSynchronizedWithCurrentItem="false"
                                  SelectedItem="{Binding SelectedPredicate.Operator,UpdateSourceTrigger=Explicit}"/>
                        <Separator Opacity="0" Width="5"/>
                        <CheckBox Name="MatchAnyPredicateCheckbox" Padding="2"
                                  IsChecked="{Binding MatchAnyPredicate}"/>
                        <TextBlock TextWrapping="Wrap" Text="Match any predicate" />
                    </StackPanel>
                    <Separator Opacity="0" Height="5"/>
                    <StackPanel Orientation="Horizontal">
                        <Label Width="100">Value:</Label>
                        <TextBox Name="PredicateValue" Width="150"
                                 Text="{Binding SelectedPredicate.FieldValue,UpdateSourceTrigger=Explicit}"/>
                    </StackPanel>
                </StackPanel>
            </TabItem>
        </TabControl>
    </Grid>
</UserControl>
